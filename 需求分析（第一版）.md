# 需求分析：观影室创建与加入

## 一、 UC-01 创建观影室 (Create Screening Room)

用例片段：创建观影室 ———— 初始化与权限分配

范围：用户在界面提交创建请求，系统验证用户权限与房间配额，实例化房间对象，并确立房主身份。

前置条件：用户已登录。

### 1. 根据 UC-01 创建观影室用例描述提取候选类

- “用户填写房间名称、设置密码...” ——> **创建房间面板UI类 (`CreateRoomUI`)**
- “系统验证请求参数...检测用户已达到最大持有的房间数量限制” ——> **房间生命周期控制器 (`RoomLifecycleControl`)**，职责：协调创建流程，执行业务规则校验。
- “系统在数据库中创建一个新的观影室实例” ——> **观影室实体类 (`ScreeningRoom`)**，职责：封装房间数据（ID、名称、密码）。
- “将发起用户指定为该房间的房主” ——> **用户实体类 (`User`)**，职责：维护用户角色与已创建房间列表。

### 2. 健壮性分析 (Robustness Analysis)

|

| 关键对象类型 | 类名称 | 职责 |

| 边界对象 | CreateRoomUI | 创建房间的交互界面，负责接收房间名、密码、模式设置，并向用户反馈创建结果。 |

| 控制对象 | RoomLifecycleControl | 房间生命周期控制器。负责协调创建逻辑：1.向User实体查询已创建数并校验；2.实例化ScreeningRoom；3.关联房主权限。 |

| 实体对象 | User | 封装用户信息。提供“已创建房间数”数据供校验，并记录用户与新房间的房主关系。 |

| 实体对象 | ScreeningRoom | 封装房间核心数据（ID, Name, Password, Config）。 |

### 3. 健壮性交互流程

1. 用户在 `CreateRoomUI` 输入配置并点击创建。
2. UI 通知 `RoomLifecycleControl` 处理请求。
3. `RoomLifecycleControl` 访问 `User` 实体，验证创建数量是否超限 (业务规则)。
4. 验证通过后，`RoomLifecycleControl` 实例化一个新的 `ScreeningRoom` 对象。
5. `RoomLifecycleControl` 调用 `User` 实体，更新其身份为该房间房主。
6. 系统返回新房间ID至 `CreateRoomUI`，跳转进入。

### 4. 交互建模

#### 通信图 (Communication Diagram)

![创建-通信图](E:\大型软件开发\uml建模\创建-通信图.png)

#### 顺序图 (Sequence Diagram)

![创建-顺序图](E:\大型软件开发\uml建模\创建-顺序图.png)

#### 5. 通信图 -> 类图推导

![创建-类图](E:\大型软件开发\uml建模\创建-类图.png)

## 二、 UC-02 加入观影室 (Join Screening Room)

**用例片段**：加入观影室 ———— 准入验证与状态同步 **范围**：用户输入房间号，系统验证房间是否存在、是否满员及密码正确性，通过后将用户加入列表并同步当前播放状态。 **前置条件**：用户已知晓房间ID。

### 1. 根据 UC-02 加入观影室用例描述提取候选类

- “用户向系统发起加入指定观影室的请求” ——> **加入房间面板UI类 (`JoinRoomUI`)**
- “系统验证加入条件（满员、密码）” ——> **加入请求控制器 (`JoinAccessControl`)**，职责：负责准入控制逻辑。
- “系统将用户添加到该房间的在线成员列表中” ——> **观影室实体类 (`ScreeningRoom`)**，职责：维护成员列表、密码哈希、人数上限。
- “系统获取房间当前的播放状态...同步给用户” ——> **房间状态实体类 (`RoomState`)**，职责：维护播放进度、视频源等动态数据（这是教材中强调的将动态状态与静态数据分离的设计）。

### 2. 健壮性分析 (Robustness Analysis)

| 关键对象类型 | 类名称 | 职责 |

| 边界对象 | JoinRoomUI | 加入界面，接收房间ID和密码，初始化播放器组件。 |

| 控制对象 | JoinAccessControl | 加入控制器。1.验证房间存在；2.验证密码；3.验证人数；4.若通过，触发成员添加和状态获取。 |

| 实体对象 | ScreeningRoom | 存储静态属性（密码、最大人数、成员列表）。 |

| 实体对象 | RoomState | 存储动态属性（当前视频、时间戳、播放/暂停状态）。 |

### 3. 健壮性交互流程

1. 用户在 `JoinRoomUI` 输入房间号和密码。
2. UI 请求 `JoinAccessControl` 处理。
3. `JoinAccessControl` 访问 `ScreeningRoom` 获取配置（密码、人数）。
4. 控制器执行验证（Subflow S1: 密码匹配 & 未满员）。
5. 验证通过后，控制器调用 `ScreeningRoom` 添加成员。
6. 控制器访问 `RoomState` 获取当前播放快照（视频、进度）。
7. 系统返回同步数据包至 `JoinRoomUI`，客户端播放器立即同步。

### 4. 交互建模

#### 通信图 (Communication Diagram)

![加入-通信图](E:\大型软件开发\uml建模\加入-通信图.png)

#### 顺序图 (Sequence Diagram)

![加入-顺序图](E:\大型软件开发\uml建模\加入-顺序图.png)

#### 5. 通信图 -> 类图推导

![加入-类图](E:\大型软件开发\uml建模\加入-类图.png)